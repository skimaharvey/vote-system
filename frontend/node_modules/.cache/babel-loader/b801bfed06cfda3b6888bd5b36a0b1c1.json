{"ast":null,"code":"import _regeneratorRuntime from\"/Users/ski/Documents/buildspace/vote-system/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/ski/Documents/buildspace/vote-system/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/ski/Documents/buildspace/vote-system/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from'react';import{ethers}from'ethers';import CheckVoterAddress from'./CheckVoterAddress';import Proposals from'./Proposals';import AddVoter from'./AddVoter';import TokenArtifact from'../ABI/Ballot.json';import contractAddress from'../ABI/contract-address.json';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export var Dapp=function Dapp(){var _useState=useState(),_useState2=_slicedToArray(_useState,2),token=_useState2[0],setToken=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),newVoter=_useState4[0],setNewVoter=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),newVoterStatus=_useState6[0],setNewVoterStatus=_useState6[1];var _useState7=useState(),_useState8=_slicedToArray(_useState7,2),voterStatus=_useState8[0],setVoterStatus=_useState8[1];var _useState9=useState(''),_useState10=_slicedToArray(_useState9,2),voterAddressToCheck=_useState10[0],setVoterAddressToCheck=_useState10[1];var _useState11=useState([]),_useState12=_slicedToArray(_useState11,2),proposals=_useState12[0],setProposals=_useState12[1];var _useState13=useState(''),_useState14=_slicedToArray(_useState13,2),chairperson=_useState14[0],setChairperson=_useState14[1];var _useState15=useState(0),_useState16=_slicedToArray(_useState15,2),numberOfVotes=_useState16[0],setNumberOfVotes=_useState16[1];var _useState17=useState(false),_useState18=_slicedToArray(_useState17,2),showError=_useState18[0],setShowError=_useState18[1];// **************** Ethers Connection for the SmartContract ****************\nfunction _initialize(){return _initialize2.apply(this,arguments);}function _initialize2(){_initialize2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return _intializeEthers();case 2:case\"end\":return _context5.stop();}}},_callee5);}));return _initialize2.apply(this,arguments);}var _intializeEthers=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _provider,_token,newProposal,nVotes,newChairperson;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:// ethers connection for the smartcontract\n_provider=new ethers.providers.Web3Provider(window.ethereum);_token=new ethers.Contract(contractAddress.Token,TokenArtifact.abi,_provider.getSigner(0));// get the proposals\n_context.next=4;return _token.getAllProposals();case 4:newProposal=_context.sent;nVotes=0;newProposal.forEach(function(arr){return nVotes+=arr.voteCount.toNumber();});// get the chairman address\nsetNumberOfVotes(nVotes);_context.next=10;return _token.chairperson();case 10:newChairperson=_context.sent;// save the token data into a hook to reuse it along the app\nsetToken(_token);setProposals(newProposal);setChairperson(newChairperson);case 14:case\"end\":return _context.stop();}}},_callee);}));return function _intializeEthers(){return _ref.apply(this,arguments);};}();// Connects to the smart contract token id (check /contracts/contract-address.json)\nfunction init(){return _init.apply(this,arguments);}function _init(){_init=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(){var _yield$window$ethereu,_yield$window$ethereu2,selectedAddress;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_context6.next=2;return window.ethereum.enable();case 2:_yield$window$ethereu=_context6.sent;_yield$window$ethereu2=_slicedToArray(_yield$window$ethereu,1);selectedAddress=_yield$window$ethereu2[0];_initialize(selectedAddress);case 6:case\"end\":return _context6.stop();}}},_callee6);}));return _init.apply(this,arguments);}useEffect(function(){// When the page loads it will initialize the init function\n// that we need to connect the frontend with the smartcontract\ninit();},[]);function updateVoteNumber(_x){return _updateVoteNumber.apply(this,arguments);}function _updateVoteNumber(){_updateVoteNumber=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(block){var newProposal,nVotes;return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:_context7.next=2;return token.getAllProposals();case 2:newProposal=_context7.sent;nVotes=0;newProposal.forEach(function(arr){return nVotes+=arr.voteCount.toNumber();});setProposals(newProposal);setNumberOfVotes(nVotes);case 7:case\"end\":return _context7.stop();}}},_callee7);}));return _updateVoteNumber.apply(this,arguments);}useEffect(function(){if(token){token.on(\"newVote\",updateVoteNumber);}return function(){if(token){token.off(\"newVote\",null);}};},[token]);// **************** Here Starts The Real Logic of the Frontend -> SmartContract ****************\n// Vote the selected proposal (you can only vote one time)\nvar voteProposal=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(proposal){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return token.vote(proposal);case 3:_context2.next=10;break;case 5:_context2.prev=5;_context2.t0=_context2[\"catch\"](0);console.log(\"error: \",_context2.t0[\"message\"]);setShowError(true);setTimeout(function(){return setShowError(false);},2000);case 10:case\"end\":return _context2.stop();}}},_callee2,null,[[0,5]]);}));return function voteProposal(_x2){return _ref2.apply(this,arguments);};}();// Check if the address the user entered is a a voter or not\nvar checkAddressVoter=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var voterData;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return token.voters(\"\".concat(voterAddressToCheck));case 3:voterData=_context3.sent;setVoterStatus(voterData);_context3.next=11;break;case 7:_context3.prev=7;_context3.t0=_context3[\"catch\"](0);console.log(_context3.t0);setVoterStatus('An error has occured');case 11:case\"end\":return _context3.stop();}}},_callee3,null,[[0,7]]);}));return function checkAddressVoter(){return _ref3.apply(this,arguments);};}();// It gives the right to vote to a new address\nvar addNewVoter=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.prev=0;_context4.next=3;return token.giveRightToVote(newVoter);case 3:setNewVoterStatus('Success');_context4.next=10;break;case 6:_context4.prev=6;_context4.t0=_context4[\"catch\"](0);console.log(_context4.t0);setNewVoterStatus('An error has occured');case 10:case\"end\":return _context4.stop();}}},_callee4,null,[[0,6]]);}));return function addNewVoter(){return _ref4.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"div\",{style:{padding:'3rem 5rem'},children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Voting System\"}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Number Of Votee: \",numberOfVotes]}),showError?/*#__PURE__*/_jsx(\"p\",{style:{height:32,color:'red'},children:\"You probably already voted\"}):/*#__PURE__*/_jsx(\"p\",{style:{height:32}}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"h4\",{children:[\"chairperson: \",chairperson]})}),/*#__PURE__*/_jsx(Proposals,{proposals:proposals,voteProposal:voteProposal}),/*#__PURE__*/_jsx(AddVoter,{addNewVoter:addNewVoter,setNewVoter:setNewVoter,newVoter:newVoter,newVoterStatus:newVoterStatus}),/*#__PURE__*/_jsx(CheckVoterAddress,{voterAddressToCheck:voterAddressToCheck,setVoterAddressToCheck:setVoterAddressToCheck,checkAddressVoter:checkAddressVoter,voterStatus:voterStatus})]});};","map":{"version":3,"sources":["/Users/ski/Documents/buildspace/vote-system/frontend/src/components/Dapp.js"],"names":["React","useEffect","useState","ethers","CheckVoterAddress","Proposals","AddVoter","TokenArtifact","contractAddress","Dapp","token","setToken","newVoter","setNewVoter","newVoterStatus","setNewVoterStatus","voterStatus","setVoterStatus","voterAddressToCheck","setVoterAddressToCheck","proposals","setProposals","chairperson","setChairperson","numberOfVotes","setNumberOfVotes","showError","setShowError","_initialize","_intializeEthers","_provider","providers","Web3Provider","window","ethereum","_token","Contract","Token","abi","getSigner","getAllProposals","newProposal","nVotes","forEach","arr","voteCount","toNumber","newChairperson","init","enable","selectedAddress","updateVoteNumber","block","on","off","voteProposal","proposal","vote","console","log","setTimeout","checkAddressVoter","voters","voterData","addNewVoter","giveRightToVote","padding","height","color"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\n\nimport { ethers } from 'ethers';\n\nimport CheckVoterAddress from './CheckVoterAddress';\nimport Proposals from './Proposals';\nimport AddVoter from './AddVoter';\n\nimport TokenArtifact from '../ABI/Ballot.json';\nimport contractAddress from '../ABI/contract-address.json';\n\nexport const Dapp = () => {\n\tconst [token, setToken] = useState();\n\tconst [newVoter, setNewVoter] = useState('');\n\tconst [newVoterStatus, setNewVoterStatus] = useState('');\n\tconst [voterStatus, setVoterStatus] = useState();\n\tconst [voterAddressToCheck, setVoterAddressToCheck] = useState('');\n\tconst [proposals, setProposals] = useState([]);\n\tconst [chairperson, setChairperson] = useState('');\n\tconst [numberOfVotes, setNumberOfVotes] = useState(0)\n\tconst [showError, setShowError] = useState(false)\n\t// **************** Ethers Connection for the SmartContract ****************\n\n\tasync function _initialize() {\n\t\tawait _intializeEthers();\n\t}\n\n\tconst _intializeEthers = async () => {\n\t\t// ethers connection for the smartcontract\n\t\tconst _provider = new ethers.providers.Web3Provider(window.ethereum);\n\n\t\tconst _token = new ethers.Contract(\n\t\t\tcontractAddress.Token,\n\t\t\tTokenArtifact.abi,\n\t\t\t_provider.getSigner(0)\n\t\t);\n\n\t\t// get the proposals\n\t\tconst newProposal = await _token.getAllProposals();\n\t\tlet nVotes = 0\n\t\tnewProposal.forEach(arr => nVotes += arr.voteCount.toNumber())\n\t\t// get the chairman address\n\t\tsetNumberOfVotes(nVotes)\n\t\tconst newChairperson = await _token.chairperson();\n\n\t\t// save the token data into a hook to reuse it along the app\n\t\tsetToken(_token);\n\t\tsetProposals(newProposal);\n\t\tsetChairperson(newChairperson);\n\t};\n\n\t// Connects to the smart contract token id (check /contracts/contract-address.json)\n\tasync function init() {\n\t\tconst [selectedAddress] = await window.ethereum.enable();\n\t\t_initialize(selectedAddress);\n\t}\n\n\tuseEffect(() => {\n\t\t// When the page loads it will initialize the init function\n\t\t// that we need to connect the frontend with the smartcontract\n\t\tinit();\n\t}, []);\n\n\tasync function updateVoteNumber(block) {\n\t\tconst newProposal = await token.getAllProposals();\n\t\tlet nVotes = 0\n\t\tnewProposal.forEach(arr => nVotes += arr.voteCount.toNumber())\n\t\tsetProposals(newProposal);\n\t\tsetNumberOfVotes(nVotes)\n\t}\n\n\tuseEffect(() => {\n\t\tif(token) {\n\t\t\ttoken.on(\"newVote\",updateVoteNumber )\n\t\t}\n\t\treturn () => {\n\t\t\tif(token){\n\t\t\t\ttoken.off(\"newVote\", null)\n\t\t\t}\n\t\t}\n\t}, [token])\n\n\t// **************** Here Starts The Real Logic of the Frontend -> SmartContract ****************\n\n\t// Vote the selected proposal (you can only vote one time)\n\tconst voteProposal = async (proposal) => {\n\t\ttry {\n\t\t\tawait token.vote(proposal);\n\t\t} catch (error) {\n\t\t\tconsole.log(\"error: \",error[\"message\"])\n\t\t\tsetShowError(true)\n\t\t\tsetTimeout(() => setShowError(false), 2000)\n\t\t}\n\t};\n\n\t// Check if the address the user entered is a a voter or not\n\tconst checkAddressVoter = async () => {\n\t\ttry {\n\t\t\tconst voterData = await token.voters(`${voterAddressToCheck}`);\n\t\t\tsetVoterStatus(voterData);\n\t\t} catch (err) {\n\t\t\tconsole.log(err);\n\t\t\tsetVoterStatus('An error has occured');\n\t\t}\n\t};\n\n\t// It gives the right to vote to a new address\n\tconst addNewVoter = async () => {\n\t\ttry {\n\t\t\tawait token.giveRightToVote(newVoter);\n\t\t\tsetNewVoterStatus('Success');\n\t\t} catch (err) {\n\t\t\tconsole.log(err);\n\t\t\tsetNewVoterStatus('An error has occured');\n\t\t}\n\t};\n\n\treturn (\n\t\t<div style={{ padding: '3rem 5rem' }}>\n\t\t\t<h1>Voting System</h1>\n\t\t\t<p>Number Of Votee: {numberOfVotes}</p>\n\t\t\t{showError? \n\t\t\t\t<p\n\t\t\t\t\tstyle={{height: 32, color: 'red'}}\n\t\t\t\t>You probably already voted</p>\n\t\t\t:\n\t\t\t\t<p style={{height: 32}}></p>\n\t\t\t}\n\t\t\t<div>\n\t\t\t\t<h4>chairperson: {chairperson}</h4>\n\t\t\t</div>\n\t\t\t<Proposals proposals={proposals} voteProposal={voteProposal} />\n\t\t\t<AddVoter\n\t\t\t\taddNewVoter={addNewVoter}\n\t\t\t\tsetNewVoter={setNewVoter}\n\t\t\t\tnewVoter={newVoter}\n\t\t\t\tnewVoterStatus={newVoterStatus}\n\t\t\t/>\n\t\t\t<CheckVoterAddress\n\t\t\t\tvoterAddressToCheck={voterAddressToCheck}\n\t\t\t\tsetVoterAddressToCheck={setVoterAddressToCheck}\n\t\t\t\tcheckAddressVoter={checkAddressVoter}\n\t\t\t\tvoterStatus={voterStatus}\n\t\t\t/>\n\t\t</div>\n\t);\n};\n"]},"metadata":{},"sourceType":"module"}