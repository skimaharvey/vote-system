{"ast":null,"code":"var _jsxFileName = \"/Users/ski/Documents/buildspace/vote-system/frontend/src/components/Dapp.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState } from 'react';\nimport { ethers } from 'ethers';\nimport CheckVoterAddress from './CheckVoterAddress';\nimport Proposals from './Proposals';\nimport AddVoter from './AddVoter';\nimport TokenArtifact from '../ABI/Ballot.json';\nimport contractAddress from '../ABI/contract-address.json';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const Dapp = () => {\n  _s();\n\n  const [token, setToken] = useState();\n  const [newVoter, setNewVoter] = useState('');\n  const [newVoterStatus, setNewVoterStatus] = useState('');\n  const [voterStatus, setVoterStatus] = useState();\n  const [voterAddressToCheck, setVoterAddressToCheck] = useState('');\n  const [proposals, setProposals] = useState([]);\n  const [chairperson, setChairperson] = useState('');\n  const [numberOfVotes, setNumberOfVotes] = useState(0);\n  const [showError, setShowError] = useState(false); // **************** Ethers Connection for the SmartContract ****************\n\n  async function _initialize() {\n    await _intializeEthers();\n  }\n\n  const _intializeEthers = async () => {\n    // ethers connection for the smartcontract\n    const _provider = new ethers.providers.Web3Provider(window.ethereum);\n\n    const _token = new ethers.Contract(contractAddress.Token, TokenArtifact.abi, _provider.getSigner(0)); // get the proposals\n\n\n    const newProposal = await _token.getAllProposals();\n    let nVotes = 0;\n    newProposal.map(arr => nVotes += arr.voteCount.toNumber()); // get the chairman address\n\n    setNumberOfVotes(nVotes);\n    const newChairperson = await _token.chairperson(); // save the token data into a hook to reuse it along the app\n\n    setToken(_token);\n    setProposals(newProposal);\n    setChairperson(newChairperson);\n  }; // Connects to the smart contract token id (check /contracts/contract-address.json)\n\n\n  async function init() {\n    const [selectedAddress] = await window.ethereum.enable();\n\n    _initialize(selectedAddress);\n  }\n\n  useEffect(() => {\n    // When the page loads it will initialize the init function\n    // that we need to connect the frontend with the smartcontract\n    init();\n  }, []);\n\n  async function updateVoteNumber(block) {\n    const newProposal = await token.getAllProposals();\n    let nVotes = 0;\n    newProposal.map(arr => nVotes += arr.voteCount.toNumber()); // get the chairman address\n\n    setNumberOfVotes(nVotes);\n  }\n\n  useEffect(() => {\n    if (token) {\n      token.on(\"newVote\", updateVoteNumber);\n    }\n\n    return () => {\n      if (token) {\n        token.off(\"newVote\", null);\n      }\n    };\n  }, [token]); // **************** Here Starts The Real Logic of the Frontend -> SmartContract ****************\n  // Vote the selected proposal (you can only vote one time)\n\n  const voteProposal = async proposal => {\n    try {\n      await token.vote(proposal);\n    } catch (error) {\n      console.log(\"error: \", error[\"message\"]);\n      setShowError(true);\n      setTimeout(() => setShowError(false), 2000);\n    }\n  }; // Check if the address the user entered is a a voter or not\n\n\n  const checkAddressVoter = async () => {\n    try {\n      const voterData = await token.voters(`${voterAddressToCheck}`);\n      setVoterStatus(voterData);\n    } catch (err) {\n      console.log(err);\n      setVoterStatus('An error has occured');\n    }\n  }; // It gives the right to vote to a new address\n\n\n  const addNewVoter = async () => {\n    try {\n      await token.giveRightToVote(newVoter);\n      setNewVoterStatus('Success');\n    } catch (err) {\n      console.log(err);\n      setNewVoterStatus('An error has occured');\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      padding: '3rem 5rem'\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n      children: \"Voting System\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 120,\n      columnNumber: 4\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      children: [\"Number Of Votee: \", numberOfVotes]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 4\n    }, this), showError ? /*#__PURE__*/_jsxDEV(\"p\", {\n      style: {\n        height: 32,\n        color: 'red'\n      },\n      children: \"You probably already voted\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 123,\n      columnNumber: 5\n    }, this) : /*#__PURE__*/_jsxDEV(\"p\", {\n      style: {\n        height: 32\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 127,\n      columnNumber: 5\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      children: /*#__PURE__*/_jsxDEV(\"h4\", {\n        children: [\"chairperson: \", chairperson]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 130,\n        columnNumber: 5\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 129,\n      columnNumber: 4\n    }, this), /*#__PURE__*/_jsxDEV(Proposals, {\n      proposals: proposals,\n      voteProposal: voteProposal\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 132,\n      columnNumber: 4\n    }, this), /*#__PURE__*/_jsxDEV(AddVoter, {\n      addNewVoter: addNewVoter,\n      setNewVoter: setNewVoter,\n      newVoter: newVoter,\n      newVoterStatus: newVoterStatus\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 133,\n      columnNumber: 4\n    }, this), /*#__PURE__*/_jsxDEV(CheckVoterAddress, {\n      voterAddressToCheck: voterAddressToCheck,\n      setVoterAddressToCheck: setVoterAddressToCheck,\n      checkAddressVoter: checkAddressVoter,\n      voterStatus: voterStatus\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 139,\n      columnNumber: 4\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 119,\n    columnNumber: 3\n  }, this);\n};\n\n_s(Dapp, \"CD2C3tKJDi61FT9/bwFr7zw+M9c=\");\n\n_c = Dapp;\n\nvar _c;\n\n$RefreshReg$(_c, \"Dapp\");","map":{"version":3,"sources":["/Users/ski/Documents/buildspace/vote-system/frontend/src/components/Dapp.js"],"names":["React","useEffect","useState","ethers","CheckVoterAddress","Proposals","AddVoter","TokenArtifact","contractAddress","Dapp","token","setToken","newVoter","setNewVoter","newVoterStatus","setNewVoterStatus","voterStatus","setVoterStatus","voterAddressToCheck","setVoterAddressToCheck","proposals","setProposals","chairperson","setChairperson","numberOfVotes","setNumberOfVotes","showError","setShowError","_initialize","_intializeEthers","_provider","providers","Web3Provider","window","ethereum","_token","Contract","Token","abi","getSigner","newProposal","getAllProposals","nVotes","map","arr","voteCount","toNumber","newChairperson","init","selectedAddress","enable","updateVoteNumber","block","on","off","voteProposal","proposal","vote","error","console","log","setTimeout","checkAddressVoter","voterData","voters","err","addNewVoter","giveRightToVote","padding","height","color"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\n\nimport { ethers } from 'ethers';\n\nimport CheckVoterAddress from './CheckVoterAddress';\nimport Proposals from './Proposals';\nimport AddVoter from './AddVoter';\n\nimport TokenArtifact from '../ABI/Ballot.json';\nimport contractAddress from '../ABI/contract-address.json';\n\nexport const Dapp = () => {\n\tconst [token, setToken] = useState();\n\tconst [newVoter, setNewVoter] = useState('');\n\tconst [newVoterStatus, setNewVoterStatus] = useState('');\n\tconst [voterStatus, setVoterStatus] = useState();\n\tconst [voterAddressToCheck, setVoterAddressToCheck] = useState('');\n\tconst [proposals, setProposals] = useState([]);\n\tconst [chairperson, setChairperson] = useState('');\n\tconst [numberOfVotes, setNumberOfVotes] = useState(0)\n\tconst [showError, setShowError] = useState(false)\n\t// **************** Ethers Connection for the SmartContract ****************\n\n\tasync function _initialize() {\n\t\tawait _intializeEthers();\n\t}\n\n\tconst _intializeEthers = async () => {\n\t\t// ethers connection for the smartcontract\n\t\tconst _provider = new ethers.providers.Web3Provider(window.ethereum);\n\n\t\tconst _token = new ethers.Contract(\n\t\t\tcontractAddress.Token,\n\t\t\tTokenArtifact.abi,\n\t\t\t_provider.getSigner(0)\n\t\t);\n\n\t\t// get the proposals\n\t\tconst newProposal = await _token.getAllProposals();\n\t\tlet nVotes = 0\n\t\tnewProposal.map(arr => nVotes += arr.voteCount.toNumber())\n\t\t// get the chairman address\n\t\tsetNumberOfVotes(nVotes)\n\t\tconst newChairperson = await _token.chairperson();\n\n\t\t// save the token data into a hook to reuse it along the app\n\t\tsetToken(_token);\n\t\tsetProposals(newProposal);\n\t\tsetChairperson(newChairperson);\n\t};\n\n\t// Connects to the smart contract token id (check /contracts/contract-address.json)\n\tasync function init() {\n\t\tconst [selectedAddress] = await window.ethereum.enable();\n\t\t_initialize(selectedAddress);\n\t}\n\n\tuseEffect(() => {\n\t\t// When the page loads it will initialize the init function\n\t\t// that we need to connect the frontend with the smartcontract\n\t\tinit();\n\t}, []);\n\n\tasync function updateVoteNumber(block) {\n\t\tconst newProposal = await token.getAllProposals();\n\t\tlet nVotes = 0\n\t\tnewProposal.map(arr => nVotes += arr.voteCount.toNumber())\n\t\t// get the chairman address\n\t\tsetNumberOfVotes(nVotes)\n\t}\n\n\tuseEffect(() => {\n\t\tif(token) {\n\t\t\ttoken.on(\"newVote\",updateVoteNumber )\n\t\t}\n\t\treturn () => {\n\t\t\tif(token){\n\t\t\t\ttoken.off(\"newVote\", null)\n\t\t\t}\n\t\t}\n\t}, [token])\n\n\t// **************** Here Starts The Real Logic of the Frontend -> SmartContract ****************\n\n\t// Vote the selected proposal (you can only vote one time)\n\tconst voteProposal = async (proposal) => {\n\t\ttry {\n\t\t\tawait token.vote(proposal);\n\t\t} catch (error) {\n\t\t\tconsole.log(\"error: \",error[\"message\"])\n\t\t\tsetShowError(true)\n\t\t\tsetTimeout(() => setShowError(false), 2000)\n\t\t}\n\t};\n\n\t// Check if the address the user entered is a a voter or not\n\tconst checkAddressVoter = async () => {\n\t\ttry {\n\t\t\tconst voterData = await token.voters(`${voterAddressToCheck}`);\n\t\t\tsetVoterStatus(voterData);\n\t\t} catch (err) {\n\t\t\tconsole.log(err);\n\t\t\tsetVoterStatus('An error has occured');\n\t\t}\n\t};\n\n\t// It gives the right to vote to a new address\n\tconst addNewVoter = async () => {\n\t\ttry {\n\t\t\tawait token.giveRightToVote(newVoter);\n\t\t\tsetNewVoterStatus('Success');\n\t\t} catch (err) {\n\t\t\tconsole.log(err);\n\t\t\tsetNewVoterStatus('An error has occured');\n\t\t}\n\t};\n\n\treturn (\n\t\t<div style={{ padding: '3rem 5rem' }}>\n\t\t\t<h1>Voting System</h1>\n\t\t\t<p>Number Of Votee: {numberOfVotes}</p>\n\t\t\t{showError? \n\t\t\t\t<p\n\t\t\t\t\tstyle={{height: 32, color: 'red'}}\n\t\t\t\t>You probably already voted</p>\n\t\t\t:\n\t\t\t\t<p style={{height: 32}}></p>\n\t\t\t}\n\t\t\t<div>\n\t\t\t\t<h4>chairperson: {chairperson}</h4>\n\t\t\t</div>\n\t\t\t<Proposals proposals={proposals} voteProposal={voteProposal} />\n\t\t\t<AddVoter\n\t\t\t\taddNewVoter={addNewVoter}\n\t\t\t\tsetNewVoter={setNewVoter}\n\t\t\t\tnewVoter={newVoter}\n\t\t\t\tnewVoterStatus={newVoterStatus}\n\t\t\t/>\n\t\t\t<CheckVoterAddress\n\t\t\t\tvoterAddressToCheck={voterAddressToCheck}\n\t\t\t\tsetVoterAddressToCheck={setVoterAddressToCheck}\n\t\t\t\tcheckAddressVoter={checkAddressVoter}\n\t\t\t\tvoterStatus={voterStatus}\n\t\t\t/>\n\t\t</div>\n\t);\n};\n"]},"metadata":{},"sourceType":"module"}